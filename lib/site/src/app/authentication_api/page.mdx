export const metadata = {
  title: 'Internal Authentication Api',
  description:
    "This is a document that covers alot of ground in our internal authentication system. This is a good point of refernce if you are someone who is needing to work in this functional area. We tend to keep it locked down so this is probably the most your going to see on it. We'll try to be comprehensive.",
}

# Internal Authentication Api

This is a document that covers alot of ground in our internal authentication system. This is a good point of refernce if you are someone who is needing to work in this functional area. We tend to keep it locked down so this is probably the most your going to see on it. We'll try to be comprehensive.

What you can expect to see in this service is a comprehensive jwt based authentication system. This service is hosted directly on cloudflare.

The system as it is, in-progress

```sh
/* Public Routes (No Auth Required) ------------------------------*/
OK    POST    /v3/auth/p/signup              // new user registration returns JWT
OK    POST    /v3/auth/p/login               // user login, returns JWT
OK    POST    /v3/auth/p/refresh-token       // refresh access token using refresh token
TODO  POST    /v3/auth/p/forgot-password     // initiate password reset
TODO  POST    /v3/auth/p/reset-password      // complete password reset with token
OK    GET     /v3/auth/p/verify-email/:token // verify email with token
TODO  POST    /v3/auth/p/resend-verification // resend verification email

/* Protected Routes (Valid JWT Required) ---------------------------------*/
TODO  POST    /v3/auth/logout              // invalidate current token
TODO  PUT     /v3/auth/change-password     // change password while logged in
TODO  GET     /v3/auth/me                  // get current user info
TODO  PUT     /v3/auth/me                  // update user info
TODO  DELETE  /v3/auth/me                  // delete account

/* Admin Routes (Admin JWT Required) -----------------------------*/
TODO  GET     /v3/auth/users               // list all users
TODO  GET     /v3/auth/users/:id           // get specific user
TODO  PUT     /v3/auth/users/:id/status    // modify user status (suspend/activate)
TODO  DELETE  /v3/auth/users/:id           // delete user account
```

## Sign Up

To sign up for a new account, you just need to pass a unique email and strong password (twice)

### Request

- **Endpoint:** `POST /sign-up`
- **Content-Type:** `application/json`

The sign-up endpoint requires three fields to create a new account. Make sure your password meets the strength requirements.

<Row>
  <Col>

    <Properties>
      <Property name="email" type="string">
        User's email address. Must be valid format and maximum 255 characters.
      </Property>
      <Property name="password" type="string">
        Password must be 8-20 characters with at least one uppercase letter, lowercase letter, number, and special character (!@#$%^&*).
      </Property>
      <Property name="confirmPassword" type="string">
        Must match exactly with the password field.
      </Property>
    </Properties>

  </Col>
  <Col>

    <CodeGroup title="Sign-up request examples">

    ```bash {{ title: 'cURL' }}
    curl -X POST 'http://example.com/sign-up' \
    -H 'Content-Type: application/json' \
    -d '{
        "email": "user@example.com",
        "password": "yourpassword123",
        "confirmPassword": "yourpassword123"
    }'
    ```

    ```js {{ title: 'JavaScript' }}
    fetch('http://example.com/sign-up', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: 'user@example.com',
        password: 'yourpassword123',
        confirmPassword: 'yourpassword123',
      }),
    })
    ```

    ```python {{ title: 'Python' }}
    import requests

    requests.post('http://example.com/sign-up',
        json={
            'email': 'user@example.com',
            'password': 'yourpassword123',
            'confirmPassword': 'yourpassword123'
        }
    )
    ```

    ```go {{ title: 'Go' }}
    import "net/http"

    data := `{
        "email": "user@example.com",
        "password": "yourpassword123",
        "confirmPassword": "yourpassword123"
    }`

    http.Post(
        "http://example.com/sign-up",
        "application/json",
        strings.NewReader(data),
    )
    ```

    </CodeGroup>

  </Col>
</Row>

### Response

**Success Response:** `200 OK`

```json
{
  "access_token": "string",
  "token_type": "Bearer",
  "expires_in": 3600
}
```

All fields are required.

**Under the hood**

When we send this request, theres quite a few steps happening. Here's the general flow

1. Zod validates the password "strength"
2. Confirm the `password` matches the `confirmPassword` field
3. Use `passwordService.hashPassword` hash the password
4. Create this user in the database, assign a default `user.status` of `"pending"`
5. Use `passwordService.addToPasswordHistory` to assign the password to the users password_history
6. Use `emailService.sendVerificationEmail` to send a token for account verification
7. Use `jwtService.assignRefreshToken` to create refresh token
8. Send `SignUpResponse`
